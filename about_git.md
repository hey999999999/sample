> **この文書は書きかけです**

まだ社内技術文書として存在していないようなので、とりあえず私が知っていることをつらつらと書きます。

# gitとは

オープンソースの**バージョン管理システム**です。読みは「ぎっと」です。
Linuxカーネルの作者であるリーナス・トーバルツによって作られました。

## バージョン管理システムとは

ファイルの更新履歴を管理するシステムのことです。
他に有名なものとしては「CVS」「Subversion」などがあります。

一般的にバージョン管理システムにファイルの更新内容を格納する操作を**チェックイン**と呼びます。
チェックインされた状態の一つ一つを**バージョン**と呼びます。
バージョンが格納されている場所を**リポジトリ**と呼びます。
リポジトリからバージョンを取り出す操作を**チェックアウト**と呼びます。

## gitの場合

### コミット
gitにおけるバージョンを管理する対象は変更されたファイルを含むディレクトリツリーです。
gitではバージョンをチェックインすることを「**コミットする**」と表現します。
別の表現を使うなら「gitでは変更されたファイルを含むディレクトリツリーをコミットするとそれが新しいバージョンになる」と言えます。

そして（これが紛らわしいのですが）gitではバージョンを**コミット**と呼びます。
つまり「gitでは変更されたファイルを含むディレクトリツリーをコミットすると新しいコミットができる」と言えます。
git語における「コミット」は名詞と動詞で意味が違うという点に注意してください。
gitにおける名詞の「コミット」は一般的なバージョン管理システムで言うところの「バージョン」と同じです。
gitにおける動詞の「コミット」は一般的なバージョン管理システムで言うところの「チェックイン」と同じです。

### ディレクトリ構成

作業者が作業を行っているディレクトリツリーを**作業ディレクトリ(working directory)**と呼びます。

> 他のバージョン管理システムでは「作業コピー」とか「作業ツリー」のように呼ばれているため、gitの書籍などでもそちらの呼称が使われることもあるようですが、同じ意味です。

gitでは作業ディレクトリの変更をリポジトリにコミットするには、一旦次のコミットに含める変更内容を**索引（index）**という領域にコピーする必要があります。
索引に作業ディレクトリの変更をコピーする操作を「**ステージ(stage)する**」と表現します。

> 索引にステージする操作を表現する言い回しには色々あり、非常に紛らわしいです。
> 以下はすべて同じ意味です。
- 索引にステージする。
- インデックスに登録する。（←英語で言っただけ）
- git addする。（←索引にステージするコマンドなので）

作業ディレクトリの最上位のディレクトリには「.git」という名前のディレクトリがあり、ここにはリポジトリと索引の実体が格納されています。
なお、チェックアウトする際も索引を経由します。作業ディレクトリと索引の両方にチェックアウト対象のコミットがコピーされます。

### ローカルリポジトリとリモートリポジトリ

gitを使った開発では自分が作業しているPC上に存在していて自分だけが使うリポジトリと、ネットワーク上に存在していて開発チームで共有して利用するリポジトリがあります。
自分のPCにある自分だけが使うリポジトリを**ローカルリポジトリ**、ネットワークで共有して利用するリポジトリを**リモートリポジトリ**と呼びます。
インターネット上のgitのリモートリポジトリを提供するサービスとして有名なものは「GitHub」「IBM Bluemix DevOps」などがあります。

# インストール

本文書ではgitのコマンドラインツールを使用します。これは以下で入手できます。
https://git-scm.com/download

> Mac OS X Mavericks (10.9)以降であればXcode Command Line Toolsをインストールすることでも利用できるようになります。最初にターミナルからgitコマンドを実行しようとすると自動的にインストーラが起動します。

## gitの設定

gitの設定ファイルが格納されている場所は三箇所あります。

- システム(system)。場所は/etc/gitconfig。マシン全体の設定を保持している。普通使わないので覚える必要なし。
- グローバル(global)。場所はユーザーのホームディレクトリの~/.gitconfig。ユーザごとの設定を保持。
- ローカル(local)。場所はプロジェクトの最上位ディレクトリの.git/config。プロジェクトごとの設定を保持。

現在の設定値を参照したり変更したりするには`git config`コマンドを使用します。

|やりたいこと|コマンド|
|---|---|
|グローバルの設定を見る|`git config --global -l`|
|ローカルの設定を見る|`git config --local -l`|
|グローバルの設定を変更する|`git config --global キー文字列 設定値`|
|ローカルの設定を変更する|`git config --local キー文字列 設定値`|

最初はとりあえず以下の三つをグローバル設定しておくとよいでしょう。

```
git config --global user.name あなたの名前
git config --global user.email あなたのメールアドレス
git config --global push.default simple
```

> 設定キー「push.default」には「ブランチおよびタグを指定せずにリモートリポジトリにプッシュした際のデフォルトの挙動」を指定します。意味が分からなければとりあえず「simple」を設定しておけば大丈夫です。

## ローカルリポジトリの作成

ローカルリポジトリを作成する方法は以下の二通りがあります。

|やりたいこと|コマンド|
|---|---|
|カレントディレクトリ以下のディレクトリツリーを作業ディレクトリとみなして、カレントディレクトリの.gitディレクトリの下にリポジトリと索引を作成|`git init`|
|リモートリポジトリを自ＰＣにコピーしてローカルリポジトリ、 索引、作業ディレクトリを作成|`git clone`|

殆どの場合、`git init`でローカルリポジトリを作成することはなく、`git clone`で上位者（プロジェクトリーダーなど）から伝達されるリモートリポジトリを元にローカルリポジトリを作成することになるかと思います。

```
git clone リモートリポジトリのURL
```

## 索引にステージする

作業ディレクトリの変更内容を索引にステージするには`git add`コマンドを使用します。

```
git add ファイルまたはディレクトリ名
```

ディレクトリ名を指定した場合は「そのディレクトリ以下に含まれる全てのファイルやディレクトリのうちで変更があったもの全て」が対象になります。
つまりプロジェクト内のファイルを全てステージしたい場合はプロジェクトのトップディレクトリで

```
git add .
```

とすればよいことになります。このコマンドはローカルファイルシステムにあるゴミファイルなども含めて根こそぎステージしてしまうので注意が必要です。
すでに索引にあるファイル（やディレクトリ）だけを作業ディレクトリからすべてコピーするには、

```
git add -u
```

とします。

## ローカルリポジトリにコミットする

索引の準備ができたら

```
git commit
```

を実行して、索引にステージされているファイルをローカルリポジトリにコミットします。
`git commit`コマンドを実行するとテキストエディタ（デフォルトはviエディタ）が立ち上がり、コミットメッセージ（このコミットが何のための変更なのかを説明するための文章）の入力が促されますので適当な文章を入れてテキストエディタを保存終了（viエディタであれば最終行モードで`:wq`）します。

```
こんにちわ。これはコミットメッセージだよ。とりあえず変更したのでコミットするよ。よろしくね。
# Please enter the commit message for your changes. Lines starting with '#' will be ignored, and an empty message aborts the commit.
# 変更内容を入力してください。「#」で始まる行は無視されます。コミットメッセージが空だとコミットが中断されます。
#
#   :
#   :
#
```

テキストエディタを保存終了すると索引にステージされたファイルから新しいコミットが作成されてローカルリポジトリにコミットされます。
このとき、そのコミットを識別するためのハッシュ値（１６進数４０桁）が発行されます（所謂「バージョン」のようなもの）。
gitは今作業ディレクトリに存在しているディレクトリツリーはどのコミットによるものなのかを保持しており、これをHEADと呼びます。
各々のコミットは一つ前のコミットのポインタを持っています。
開発を続けていくと複数のコミットは単方向リストを形成します。（リストの末尾がHEADです）

## ブランチ

バージョン管理システムにおいて、最初のバージョンから続いているリストを「開発本線」と呼びます。
一般的なプロジェクトでは開発本線だけで開発を行うことは稀で、何らかの機能追加であるとかバグの修正であるとかリファクタリングなど、コードの変更が発生する都度、開発本線から枝を作り、その枝からさらに別のバージョンのリストを伸ばしてそれぞれの機能の開発を進めていきます。
最後に枝リストの開発が完了したら（そしてその枝の修正が妥当であるならば）枝の修正内容を開発本線に取り込みます。

この枝を**ブランチ**と呼びます。開発本線もブランチの一種です。
ブランチには任意の名前を付けることができ、gitでは開発本線のブランチにはデフォルトで「master」という名前が付けられています。
あるブランチの修正内容を別のブランチに取り込む操作を**マージ**と呼びます。

### ブランチの作成

ブランチを作成するには以下のコマンドを使うのですが・・・、

```
git branch ブランチ名
```

多くの場合はリモートで作成済のブランチをローカルにも作る、という手順になると思います。この場合のコマンドは以下のとおり。

```
git fetch origin ブランチ名
```

この方法を使うと「リモートのブランチ名と確実に合わせられる」「追跡ブランチ（後述）が自動で作られる」というメリットがあるので、使うならこっちがオススメです。

### ブランチの切り替え

HEADを別のブランチの末尾に移動させる操作のことを「ブランチの切り替え」と表現します。
ブランチを切り替えるには`git checkout`コマンドを使用します。

```
git checkout ブランチ名
```

注意が必要なのは、このコマンドは文字通りチェックアウト（＝リポジトリから指定されたバージョンを取り出すこと）を行い、索引と作業ディレクトリを更新します。
なので`git checkout`を実行する際にはかならず作業中のファイルは一旦コミットしておいてください。

### ブランチのマージ

今自分がいるブランチに特定のブランチの変更を取り込むにはマージを行います。

```
git merge 変更を取り込みたいブランチ名
```

### 衝突の解消

これはめんどくさいんだよおおおお

## ローカルリポジトリの変更をリモートリポジトリに送信する

ローカルリポジトリの変更をリモートリポジトリに送信するには`git push`コマンドを使用します。git pushコマンドには引数に「リモート名」を指定します。ほとんどの場合、リモート名は「origin（＝git cloneしたリモートリポジトリのこと）」を指定します。

```
git push origin
```

## リモートリポジトリの変更内容をローカルリポジトリに反映する

リモートリポジトリの最新の内容をダウンロードするには`git fetch`コマンドを使用します。

```
git fetch origin
```

変更内容は自動的に追跡ブランチ「origin/master」にのみコミットされているので、これをローカルリポジトリのブランチとマージします。

```
git merge origin/master
```

# まとめ

- ローカルの変更をリモートに反映するには
 - 作業ディレクトリの変更を索引にステージして`git add -u`
 - ステージされたファイルをローカルリポジトリにコミットして`git commit`
 - ローカルリポジトリの内容をリモートリポジトリに送信します`git push origin`

- リモートの変更をローカルに反映するには
 - 追跡ブランチをリモートリポジトリの最新の内容に変更して`git fetch origin`
 - 追跡ブランチをローカルのブランチにマージします`git merge origin/master`

# 参考文献
- 公式ドキュメント日本語版
 - [oembed https://git-scm.com/book/ja/v2]
- わかるGit （Kindle本）
 - [oembed https://www.amazon.co.jp/dp/B00IAOPGDO]
- 図解Git
 - [oembed https://marklodato.github.io/visual-git-guide/index-ja.html]
- さっきの取り消したい！って時のGitコマンドまとめ
 - [oembed http://qiita.com/kansiho/items/2bacecdb95d752cb38b7]
